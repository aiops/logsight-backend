CREATE TABLE applications
(
    id              UUID         NOT NULL,
    application_key VARCHAR(255) NOT NULL,
    name            VARCHAR(255),
    status          VARCHAR(255),
    user_id         UUID,
    CONSTRAINT pk_applications PRIMARY KEY (id)
);

CREATE TABLE flush
(
    id              UUID NOT NULL,
    status          VARCHAR(255),
    logs_receipt_id UUID,
    CONSTRAINT pk_flush PRIMARY KEY (id)
);

CREATE TABLE logs_receipt
(
    id             UUID                                     NOT NULL,
    order_num      INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    logs_count     INTEGER                                  NOT NULL,
    source         VARCHAR(255),
    application_id UUID,
    CONSTRAINT pk_logs_receipt PRIMARY KEY (id)
);

CREATE TABLE time_selection
(
    id             UUID NOT NULL,
    name           VARCHAR(255),
    start_time     VARCHAR(255),
    end_time       VARCHAR(255),
    date_time_type VARCHAR(255),
    user_id        UUID,
    CONSTRAINT pk_time_selection PRIMARY KEY (id)
);

CREATE TABLE token_entity
(
    token          UUID NOT NULL,
    user_id        UUID,
    token_type     INTEGER,
    token_duration BIGINT,
    expires_at     TIMESTAMP WITHOUT TIME ZONE,
    CONSTRAINT pk_tokenentity PRIMARY KEY (token)
);

CREATE TABLE users
(
    id                UUID                        NOT NULL,
    key               VARCHAR(255)                NOT NULL,
    email             VARCHAR(255)                NOT NULL,
    password          VARCHAR(255)                NOT NULL,
    date_created      TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    activation_date   TIMESTAMP WITHOUT TIME ZONE,
    has_paid          BOOLEAN                     NOT NULL,
    used_data         BIGINT,
    approaching_limit BOOLEAN,
    available_data    BIGINT,
    activated         BOOLEAN                     NOT NULL,
    user_type         INTEGER,
    CONSTRAINT pk_users PRIMARY KEY (id)
);

ALTER TABLE logs_receipt
    ADD CONSTRAINT uc_logs_receipt_order_num UNIQUE (order_num);

ALTER TABLE users
    ADD CONSTRAINT uc_users_email UNIQUE (email);

ALTER TABLE applications
    ADD CONSTRAINT FK_APPLICATIONS_ON_USER FOREIGN KEY (user_id) REFERENCES users (id);

CREATE INDEX IDX_APPLICATIONS_ON_USER ON applications (user_id);

ALTER TABLE flush
    ADD CONSTRAINT FK_FLUSH_ON_LOGS_RECEIPT FOREIGN KEY (logs_receipt_id) REFERENCES logs_receipt (id);

CREATE INDEX IDX_FLUSH_ON_LOGS_RECEIPT ON flush (logs_receipt_id);

ALTER TABLE logs_receipt
    ADD CONSTRAINT FK_LOGS_RECEIPT_ON_APPLICATION FOREIGN KEY (application_id) REFERENCES applications (id);

CREATE INDEX IDX_LOGS_RECEIPT_ON_APPLICATION ON logs_receipt (application_id);

ALTER TABLE time_selection
    ADD CONSTRAINT FK_TIME_SELECTION_ON_USER FOREIGN KEY (user_id) REFERENCES users (id);

CREATE INDEX IDX_TIME_SELECTION_ON_USER ON time_selection (user_id);